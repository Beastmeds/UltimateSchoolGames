<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate School Games</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family:'Roboto',sans-serif; margin:0; padding:0; background:#f0f0f0; color:#000; text-align:center; transition: background 0.5s; }
  .menu, .settings, .game, #adminPanel { display:none; padding:20px; max-width:600px; margin:auto; }
  .visible { display:block; }
  button { padding:10px 20px; margin:5px; border:none; border-radius:12px; cursor:pointer; background:linear-gradient(45deg,#6a11cb,#2575fc); color:white; font-weight:bold; transition:0.3s; }
  button:hover { transform: scale(1.05); box-shadow:0 0 10px #2575fc; }
  input { padding:8px; margin:5px; border-radius:5px; border:1px solid #ccc; width:calc(100% - 20px); }
  #gameArea { width:100%; height:220px; margin:20px 0; position:relative; overflow:hidden; border-radius:12px; transition: background 0.5s; background:#a0e0ff;}
  #player { width:50px; position:absolute; bottom:0px; left:50px; transition: all 0.3s; }
</style>
</head>
<body>

<!-- MENU -->
<div class="menu visible" id="menu">
  <h1>Ultimate School Games</h1>
  <button onclick="startClicker()">ğŸ« Clicker</button>
  <button onclick="startRunner()">ğŸƒ Runner</button>
  <button onclick="startSurprise()">ğŸ² Zahlenraten</button>
  <button onclick="openSettings()">âš™ Einstellungen</button>
  <button id="adminBtn" onclick="showAdminPanel()" style="display:none;">ğŸ‘‘ Admin Dashboard</button>
</div>

<!-- CLICKER -->
<div class="game" id="clickerGame">
  <h2>School Clicker</h2>
  <p>Klicks: <span id="clickCount">0</span></p>
  <button onclick="clickerClick()">Klick mich!</button>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- RUNNER -->
<div class="game" id="runnerGame">
  <h2>School Runner</h2>
  <p>Level: <span id="runnerLevel">1</span> | XP: <span id="runnerXP">0</span></p>
  <div id="gameArea">
    <img src="" id="player">
  </div>
  <button onclick="jump()">Sprung</button>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- ÃœBERRASCHUNGSSPIEL -->
<div class="game" id="surpriseGame">
  <h2>ğŸ² Zahlenraten</h2>
  <p>Rate eine Zahl von 1-10!</p>
  <input type="number" id="guessInput" min="1" max="10">
  <button onclick="checkGuess()">Rate</button>
  <p id="guessResult"></p>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- SETTINGS -->
<div class="settings" id="settingsMenu">
  <h2>âš™ Einstellungen</h2>
  <div>
    <h4>ğŸµ Musik LautstÃ¤rke</h4>
    <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5" onchange="setVolume(this.value)">
  </div>
  <div>
    <h4>ğŸ­ Skin auswÃ¤hlen</h4>
    <button onclick="changeSkin('schueler')">SchÃ¼ler</button>
    <button onclick="changeSkin('lehrer')">Lehrer</button>
    <button onclick="changeSkin('direktor')">Direktor</button>
    <button onclick="changeSkin('ninja')">Ninja</button>
  </div>
  <div>
    <h4>ğŸ–¼ Hintergrund</h4>
    <button onclick="changeBG('school')">Schule</button>
    <button onclick="changeBG('funny')">Meme</button>
    <button onclick="changeBG('gaming')">Gaming</button>
  </div>
  <div>
    <h4>ğŸ” Konto</h4>
    <button onclick="signInWithGoogle()">Mit Google einloggen</button><br>
    <input id="emailInput" type="email" placeholder="Email">
    <input id="passwordInput" type="password" placeholder="Passwort">
    <button onclick="loginUser()">Login</button>
    <button onclick="registerUser()">Registrieren</button>
    <button onclick="logoutUser()">Logout</button>
    <input type="text" id="adminEmail" placeholder="Admin Email"> 
    <button onclick="checkAdmin(document.getElementById('adminEmail').value)">Admin Login</button>
  </div>
  <div>
    <h4>ğŸ’¾ Spielstand</h4>
    <button onclick="saveGameToCloud()">Spielstand speichern</button>
    <button onclick="loadGame()">Spielstand laden</button>
    <button onclick="exportSave()">Export</button>
    <button onclick="importSave()">Import</button>
  </div>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- ADMIN -->
<div class="settings" id="adminPanel">
  <h2>ğŸ‘‘ Admin Dashboard</h2>
  <div>
    <h4>ğŸ­ Skins freischalten</h4>
    <button onclick="unlockSkin('schueler')">SchÃ¼ler</button>
    <button onclick="unlockSkin('lehrer')">Lehrer</button>
    <button onclick="unlockSkin('direktor')">Direktor</button>
    <button onclick="unlockSkin('ninja')">Ninja</button>
  </div>
  <div>
    <h4>ğŸ’¥ Extras</h4>
    <button onclick="addClicks(1000)">+1000 Klicks</button>
    <button onclick="resetAllGames()">SpielstÃ¤nde zurÃ¼cksetzen</button>
  </div>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- MUSIK -->
<audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" autoplay></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.31.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.31.0/firebase-analytics.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.31.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.31.0/firebase-firestore.js";

// ----------------- FIREBASE -----------------
const firebaseConfig = {
    apiKey: "AIzaSyDBauKzilu4O3hH68Aq0c1F5AykhAg3Db4",
    authDomain: "ultimate-school-games.firebaseapp.com",
    projectId: "ultimate-school-games",
    storageBucket: "ultimate-school-games.firebasestorage.app",
    messagingSenderId: "870332221562",
    appId: "1:870332221562:web:da450674b44bbfa18513c3",
    measurementId: "G-F8MFSLNWVB"
};
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

// ----------------- GLOBAL STATE -----------------
let state = { count:0, multiplier:1, level:1, xp:0, skin:'schueler', bgPack:'school', loggedInUser:null, isAdmin:false };
const skins = { schueler:'https://i.imgur.com/2yaf2wb.jpeg', lehrer:'https://i.imgur.com/N0r9M0V.jpeg', direktor:'https://i.imgur.com/4g0e9nS.jpeg', ninja:'https://i.imgur.com/6R3kz7w.jpeg' };
const backgrounds = { school:'#a0e0ff', funny:'#ffccff', gaming:'#d9ffcc' };

// ----------------- MENU -----------------
function startClicker(){ showGame('clickerGame'); updateDisplay(); }
function startRunner(){ showGame('runnerGame'); updateDisplay(); updateSkinImage(); updateBG(); }
function startSurprise(){ showGame('surpriseGame'); document.getElementById('guessResult').textContent=''; document.getElementById('guessInput').value=''; }
function openSettings(){ showGame('settingsMenu'); }
function backToMenu(){ document.querySelectorAll('.game,.settings').forEach(g=>g.classList.remove('visible')); document.getElementById('menu').classList.add('visible'); }
function showGame(id){ document.querySelectorAll('.game,.settings').forEach(g=>g.classList.remove('visible')); document.getElementById(id).classList.add('visible'); }

// ----------------- CLICKER -----------------
function clickerClick(){ state.count+=state.multiplier; updateDisplay(); saveGameToCloud(); }

// ----------------- RUNNER -----------------
let isJumping=false;
function jump(){
    if(isJumping) return;
    isJumping=true;
    const player=document.getElementById('player');
    let pos=0;
    let up=setInterval(()=>{ if(pos>=100){ clearInterval(up); down(); } else { pos+=10; player.style.bottom=pos+'px'; } },50);
    function down(){ let downInt=setInterval(()=>{ if(pos<=0){ clearInterval(downInt); player.style.bottom='0px'; isJumping=false; } else { pos-=10; player.style.bottom=pos+'px'; } },50);}
}

// ----------------- ÃœBERRASCHUNGSSPIEL -----------------
function checkGuess(){
    const guess=parseInt(document.getElementById('guessInput').value);
    const number=Math.floor(Math.random()*10)+1;
    if(guess===number){ document.getElementById('guessResult').textContent='ğŸ‰ Richtig! +50 Klicks!'; state.count+=50; updateDisplay(); saveGameToCloud(); }
    else { document.getElementById('guessResult').textContent='âŒ Falsch! Zahl war '+number; }
}

// ----------------- SETTINGS -----------------
function setVolume(v){ document.getElementById('bgMusic').volume=v; }
function changeSkin(s){ state.skin=s; updateSkinImage(); saveGameToCloud(); alert('Skin geÃ¤ndert: '+s); }
function updateSkinImage(){ document.getElementById('player').src=skins[state.skin]; }
function changeBG(bg){ state.bgPack=bg; updateBG(); saveGameToCloud(); alert('Hintergrund geÃ¤ndert'); }
function updateBG(){ document.getElementById('gameArea').style.background=backgrounds[state.bgPack]; }

// ----------------- EXPORT / IMPORT -----------------
function exportSave(){ const blob=new Blob([JSON.stringify(state)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='save.json'; a.click(); }
function importSave(){ const input=document.createElement('input'); input.type='file'; input.accept='.json'; input.onchange=e=>{ const file=e.target.files[0]; const reader=new FileReader(); reader.onload=e=>{ Object.assign(state,JSON.parse(e.target.result)); updateDisplay(); updateSkinImage(); updateBG(); alert('Spielstand geladen!'); }; reader.readAsText(file); }; input.click(); }

// ----------------- UPDATE DISPLAY -----------------
function updateDisplay(){ document.getElementById('clickCount').textContent=state.count; document.getElementById('runnerLevel').textContent=state.level; document.getElementById('runnerXP').textContent=state.xp; }

// ----------------- ADMIN -----------------
function checkAdmin(email){ if(email==='admin@schule.com'){ state.isAdmin=true; document.getElementById('adminBtn').style.display='inline-block'; alert('ğŸ‘‘ Admin erkannt'); } else { state.isAdmin=false; document.getElementById('adminBtn').style.display='none'; alert('âŒ Kein Admin'); } }
function showAdminPanel(){ if(!state.isAdmin){ alert('âŒ Kein Admin'); return;} showGame('adminPanel'); }
function unlockSkin(skin){ changeSkin(skin); alert('Skin freigeschaltet: '+skin); }
function addClicks(amount){ state.count+=amount; updateDisplay(); saveGameToCloud(); alert('âœ… '+amount+' Klicks hinzugefÃ¼gt'); }
function resetAllGames(){ if(confirm('âš ï¸ Alle SpielstÃ¤nde zurÃ¼cksetzen?')){ localStorage.clear(); state={ count:0, multiplier:1, level:1, xp:0, skin:'schueler', bgPack:'school', loggedInUser:null, isAdmin:false }; updateDisplay(); saveGameToCloud(); alert('âœ… ZurÃ¼ckgesetzt'); } }

// ----------------- FIREBASE LOGIN -----------------
function signInWithGoogle(){ const provider=new GoogleAuthProvider(); signInWithPopup(auth, provider).then(result=>{ state.loggedInUser=result.user.uid; checkAdmin(result.user.email); loadGame(); alert('âœ… Mit Google eingeloggt: '+result.user.email); }).catch(e=>alert('âŒ Fehler: '+e.message)); }
function loginUser(){ const email=document.getElementById('emailInput').value; const pw=document.getElementById('passwordInput').value; signInWithEmailAndPassword(auth,email,pw).then(uc=>{ state.loggedInUser=uc.user.uid; checkAdmin(email); loadGame(); alert('âœ… Eingeloggt'); }).catch(e=>alert('âŒ Fehler: '+e.message)); }
function registerUser(){ const email=document.getElementById('emailInput').value; const pw=document.getElementById('passwordInput').value; createUserWithEmailAndPassword(auth,email,pw).then(uc=>{ state.loggedInUser=uc.user.uid; checkAdmin(email); saveGameToCloud(); alert('âœ… Registriert & eingeloggt'); }).catch(e=>alert('âŒ Registrierung fehlgeschlagen: '+e.message)); }
function logoutUser(){ signOut(auth).then(()=>{ state.loggedInUser=null; state.isAdmin=false; document.getElementById('adminBtn').style.display='none'; backToMenu(); alert('ğŸ”“ Ausgeloggt'); }); }

// ----------------- CLOUD SAVE -----------------
async function saveGameToCloud(){ if(!state.loggedInUser) return; await setDoc(doc(db,'saves',state.loggedInUser),state); }
async function loadGame(){ if(!state.loggedInUser) return; const docRef=doc(db,'saves',state.loggedInUser); const docSnap=await getDoc(docRef); if(docSnap.exists()){ state=docSnap.data(); updateDisplay(); updateSkinImage(); updateBG(); alert('âœ… Spielstand geladen'); } }
</script>

</body>
</html>
