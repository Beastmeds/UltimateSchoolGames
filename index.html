<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate School Games C</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 0; padding: 0; background: linear-gradient(135deg, #4e00b4, #00d2ff); color: #fff; text-align: center; transition: background 0.5s; }
    .menu, .settings, .game, #adminPanel { display: none; padding: 20px; max-width: 600px; margin: auto; }
    .visible { display: block; }
    button { padding: 12px 24px; margin: 8px; border: none; border-radius: 12px; cursor: pointer; background: linear-gradient(45deg,#6a11cb,#2575fc); color: white; font-weight: bold; transition: transform 0.2s, box-shadow 0.2s; }
    button:hover { transform: scale(1.05); box-shadow: 0 0 12px #2575fc; }
    input { padding: 8px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; width: calc(100% - 20px); }
    #gameArea { width: 100%; height: 220px; margin: 20px 0; position: relative; overflow: hidden; border-radius: 12px; background: #72c2ff; transition: background 0.5s; }
    #player { width: 60px; position: absolute; bottom: 0px; left: 50px; transition: all 0.3s; }
    .powerup { position: absolute; width: 30px; height: 30px; background: gold; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    h1 { font-size: 2.2em; margin-bottom: 16px; background: linear-gradient(90deg,#6a11cb,#00d2ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  </style>

  <!-- Firebase & Google Login -->
  <script src="https://www.gstatic.com/firebasejs/9.31.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.31.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.31.0/firebase-firestore-compat.js"></script>
</head>
<body>

  <!-- MENU -->
  <div class="menu visible" id="menu">
    <h1>Ultimate School Games C</h1>
    <button onclick="startClicker()">ğŸ« Clicker</button>
    <button onclick="startRunner()">ğŸƒ Runner</button>
    <button onclick="openSettings()">âš™ Einstellungen</button>
    <button id="adminBtn" onclick="showAdminPanel()" style="display:none;">ğŸ‘‘ Admin Dashboard</button>
  </div>

  <!-- CLICKER -->
  <div class="game" id="clickerGame">
    <h2>School Clicker</h2>
    <p>Klicks: <span id="clickCount">0</span></p>
    <button onclick="clickerClick()">Klick mich!</button>
    <button onclick="backToMenu()">ğŸ”™ Menu</button>
  </div>

  <!-- RUNNER -->
  <div class="game" id="runnerGame">
    <h2>School Runner</h2>
    <p>Level: <span id="runnerLevel">1</span> | XP: <span id="runnerXP">0</span></p>
    <div id="gameArea">
      <img src="" id="player">
    </div>
    <button onclick="jump()">Sprung</button>
    <button onclick="backToMenu()">ğŸ”™ Menu</button>
  </div>

  <!-- SETTINGS -->
  <div class="settings" id="settingsMenu">
    <h2>âš™ Einstellungen</h2>
    <div>
      <h4>ğŸµ Musik LautstÃ¤rke</h4>
      <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5" onchange="setVolume(this.value)">
    </div>
    <div>
      <h4>ğŸ­ Skin auswÃ¤hlen</h4>
      <button onclick="changeSkin('schueler')">SchÃ¼ler</button>
      <button onclick="changeSkin('lehrer')">Lehrer</button>
      <button onclick="changeSkin('direktor')">Direktor</button>
      <button onclick="changeSkin('ninja')">Ninja</button>
    </div>
    <div>
      <h4>ğŸ–¼ Hintergrund</h4>
      <button onclick="changeBG('school')">Schule</button>
      <button onclick="changeBG('funny')">Meme</button>
      <button onclick="changeBG('gaming')">Gaming</button>
    </div>
    <div>
      <h4>ğŸ” Konto</h4>
      <button onclick="signInWithGoogle()">Mit Google einloggen</button><br>
      <input id="emailInput" type="email" placeholder="Email">
      <input id="passwordInput" type="password" placeholder="Passwort">
      <button onclick="loginUser()">Login</button>
      <button onclick="registerUser()">Registrieren</button>
      <button onclick="logoutUser()">Logout</button><br><br>
      <input type="text" id="adminEmail" placeholder="Admin Email"> 
      <button onclick="checkAdmin(document.getElementById('adminEmail').value)">Admin Login</button>
    </div>
    <div>
      <h4>ğŸ’¾ Spielstand</h4>
      <button onclick="saveGameToCloud()">Spielstand speichern</button>
      <button onclick="loadGame()">Spielstand laden</button>
      <button onclick="exportSave()">Export</button>
      <button onclick="importSave()">Import</button>
    </div>
    <button onclick="backToMenu()">ğŸ”™ Menu</button>
  </div>

  <!-- ADMIN -->
  <div class="settings" id="adminPanel">
    <h2>ğŸ‘‘ Admin Dashboard</h2>
    <div>
      <h4>ğŸ­ Skins freischalten</h4>
      <button onclick="unlockSkin('schueler')">SchÃ¼ler</button>
      <button onclick="unlockSkin('lehrer')">Lehrer</button>
      <button onclick="unlockSkin('direktor')">Direktor</button>
      <button onclick="unlockSkin('ninja')">Ninja</button>
    </div>
    <div>
      <h4>ğŸ’¥ Extras</h4>
      <button onclick="addClicks(1000)">+1000 Klicks</button>
      <button onclick="resetAllGames()">SpielstÃ¤nde zurÃ¼cksetzen</button>
      <button onclick="spawnPowerup()">âœ¨ Power-Up erstellen</button>
    </div>
    <button onclick="backToMenu()">ğŸ”™ Menu</button>
  </div>

  <!-- Musik -->
  <audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" autoplay></audio>

<script>
  // --- Firebase Konfiguration (hier deine Werte einsetzen) ---
  const firebaseConfig = {
    apiKey: "DEIN_API_KEY",
    authDomain: "DEIN_PROJEKT.firebaseapp.com",
    projectId: "DEIN_PROJEKT",
    storageBucket: "DEIN_PROJEKT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // --- Global State ---
  let state = {
    count: 0,
    multiplier: 1,
    level: 1,
    xp: 0,
    skin: 'schueler',
    bgPack: 'school',
    loggedInUser: null,
    isAdmin: false
  };

  // --- Auth mit Google ---
  function signInWithGoogle(){
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then((result) => {
        state.loggedInUser = result.user.uid;
        checkAdmin(result.user.email);
        loadGameFromCloud();
        alert('âœ… Mit Google eingeloggt: ' + result.user.email);
      })
      .catch((error) => {
        alert('âŒ Google Login fehlgeschlagen: ' + error.message);
      });
  }

  // --- Email / Passwort Auth ---
  function loginUser(){
    const email = document.getElementById('emailInput').value;
    const pw = document.getElementById('passwordInput').value;
    auth.signInWithEmailAndPassword(email, pw)
      .then(uc => { state.loggedInUser = uc.user.uid; checkAdmin(email); loadGameFromCloud(); alert('âœ… Eingeloggt'); })
      .catch(e => alert('âŒ Fehler: ' + e.message));
  }
  function registerUser(){
    const email = document.getElementById('emailInput').value;
    const pw = document.getElementById('passwordInput').value;
    auth.createUserWithEmailAndPassword(email, pw)
      .then(uc => { state.loggedInUser = uc.user.uid; checkAdmin(email); saveGameToCloud(); alert('âœ… Registriert & eingeloggt'); })
      .catch(e => alert('âŒ Registrierung fehlgeschlagen: ' + e.message));
  }
  function logoutUser(){
    auth.signOut().then(() => {
      state.loggedInUser = null;
      state.isAdmin = false;
      document.getElementById('adminBtn').style.display = 'none';
      backToMenu();
      alert('ğŸ”“ Ausgeloggt');
    });
  }

  // --- Beobachte Auth State ---
  auth.onAuthStateChanged((user) => {
    if(user){
      state.loggedInUser = user.uid;
      checkAdmin(user.email);
    } else {
      state.loggedInUser = null;
      state.isAdmin = false;
    }
  });

  // --- Speichern & Laden ---
  function saveGameToCloud(){
    if(!state.loggedInUser) return;
    db.collection('saves').doc(state.loggedInUser).set({
      count: state.count,
      level: state.level,
      xp: state.xp,
      skin: state.skin,
      bgPack: state.bgPack
    }).then(() => console.log("Spielstand gespeichert"));
  }
  function loadGameFromCloud(){
    if(!state.loggedInUser) return;
    db.collection('saves').doc(state.loggedInUser).get().then(doc => {
      if(doc.exists){
        const d = doc.data();
        state.count = d.count;
        state.level = d.level;
        state.xp = d.xp;
        state.skin = d.skin;
        state.bgPack = d.bgPack;
        updateDisplay();
        updateSkinImage();
        updateBG();
        alert('âœ… Spielstand geladen');
      } else {
        alert('â„¹ Kein Cloud-Spielstand gefunden');
      }
    });
  }

  // --- Game Logic ---
  function startClicker(){ showGame('clickerGame'); updateDisplay(); }
  function startRunner(){ showGame('runnerGame'); updateDisplay(); updateSkinImage(); updateBG(); }
  function openSettings(){ showGame('settingsMenu'); }
  function backToMenu(){ document.querySelectorAll('.game, .settings').forEach(g=>g.classList.remove('visible')); document.getElementById('menu').classList.add('visible'); }
  function showGame(id){ document.querySelectorAll('.game, .settings').forEach(g=>g.classList.remove('visible')); document.getElementById(id).classList.add('visible'); }

  function clickerClick(){
    state.count += state.multiplier;
    updateDisplay();
  }

  let isJumping=false;
  function jump(){
    if(isJumping) return;
    isJumping=true;
    const player = document.getElementById('player');
    let pos = 0;
    const up = setInterval(() => {
      if(pos >= 100){ clearInterval(up); down(); }
      else { pos += 10; player.style.bottom = pos + 'px'; }
    }, 50);
    function down(){
      const downInt = setInterval(() => {
        if(pos <= 0){ clearInterval(downInt); player.style.bottom = '0px'; isJumping=false; }
        else { pos -= 10; player.style.bottom = pos + 'px'; }
      }, 50);
    }
  }

  // --- Skins & Hintergrund ---
  const skins = {
    schueler: 'https://i.imgur.com/2yaf2wb.jpeg',
    lehrer: 'https://i.imgur.com/N0r9M0V.jpeg',
    direktor: 'https://i.imgur.com/4g0e9nS.jpeg',
    ninja: 'https://i.imgur.com/6R3kz7w.jpeg'
  };
  const backgrounds = {
    school: '#72c2ff',
    funny: '#ffccff',
    gaming: '#d9ffcc'
  };

  function changeSkin(s){
    state.skin = s;
    updateSkinImage();
    saveGameToCloud();
    alert('Skin geÃ¤ndert: ' + s);
  }
  function updateSkinImage(){
    document.getElementById('player').src = skins[state.skin];
  }

  function changeBG(bg){
    state.bgPack = bg;
    updateBG();
    saveGameToCloud();
    alert('Hintergrund geÃ¤ndert: ' + bg);
  }
  function updateBG(){
    document.getElementById('gameArea').style.background = backgrounds[state.bgPack];
  }

  // --- Export / Import ---
  function exportSave(){
    const blob = new Blob([JSON.stringify(state)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'save.json';
    a.click();
  }
  function importSave(){
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        Object.assign(state, JSON.parse(e.target.result));
        updateDisplay();
        updateSkinImage();
        updateBG();
        alert('âœ… Save importiert');
      };
      reader.readAsText(file);
    };
    input.click();
  }

  // --- Anzeige aktualisieren ---
  function updateDisplay(){
    document.getElementById('clickCount').textContent = state.count;
    document.getElementById('runnerLevel').textContent = state.level;
    document.getElementById('runnerXP').textContent = state.xp;
  }

  // --- Admin-Funktionen ---
  function checkAdmin(email){
    // Beispiel: Email â€admin@schule.comâ€œ hat Adminrechte
    if(email === 'admin@schule.com'){
      state.isAdmin = true;
      document.getElementById('adminBtn').style.display = 'inline-block';
      alert('ğŸ‘‘ Admin erkannt');
    } else {
      state.isAdmin = false;
      document.getElementById('adminBtn').style.display = 'none';
      alert('âŒ Kein Admin');
    }
  }
  function showAdminPanel(){
    if(!state.isAdmin){
      alert('âŒ Admin-Rechte fehlen');
      return;
    }
    showGame('adminPanel');
  }
  function unlockSkin(skin){
    changeSkin(skin);
    alert('Skin freigeschaltet: ' + skin);
  }
  function addClicks(amount){
    state.count += amount;
    updateDisplay();
    saveGameToCloud();
    alert('âœ… +'+amount+' Klicks');
  }
  function resetAllGames(){
    if(confirm('âš ï¸ Alle SpielstÃ¤nde lÃ¶schen?')){
      state = { count:0, multiplier:1, level:1, xp:0, skin:'schueler', bgPack:'school', loggedInUser: state.loggedInUser, isAdmin: state.isAdmin };
      saveGameToCloud();
      updateDisplay();
      updateSkinImage();
      updateBG();
      alert('âœ… ZurÃ¼ckgesetzt');
    }
  }
  function spawnPowerup(){
    const gameArea = document.getElementById('gameArea');
    const pu = document.createElement('div');
    pu.classList.add('powerup');
    pu.style.left = Math.random() * 80 + '%';
    pu.style.top = Math.random() * 150 + 'px';
    gameArea.appendChild(pu);
    setTimeout(() => {
      gameArea.removeChild(pu);
      state.count += 50;
      updateDisplay();
      saveGameToCloud();
      alert('âœ¨ Power-Up! +50 Klicks');
    }, 2000);
  }

  // --- Initial Setup ---
  updateSkinImage();
  updateBG();
  updateDisplay();
</script>

</body>
</html>
