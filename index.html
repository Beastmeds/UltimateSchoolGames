<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate School Games</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* --- Grunddesign --- */
  body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#f0f0f0; }
  .menu, .settings, .game { display:none; padding:20px; }
  .visible { display:block; }
  button { padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(45deg,#6a11cb,#2575fc); color:white; font-weight:bold; transition:0.3s; }
  button:hover { transform: scale(1.05); box-shadow:0 0 10px #2575fc; }
  input { padding:8px; margin:5px; border-radius:5px; border:1px solid #ccc; }
  h1,h2,h3,h4 { margin:5px 0; }
  #gameArea { width:100%; max-width:500px; margin:auto; text-align:center; }
  .bg-image { width:100%; height:200px; object-fit:cover; border-radius:10px; margin-bottom:10px; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.31.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.31.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.31.0/firebase-firestore-compat.js"></script>

<script>
  // --- Firebase Konfiguration ---
  const firebaseConfig = {
    apiKey: "AIzaSyDBauKzilu4O3hH68Aq0c1F5AykhAg3Db4",
    authDomain: "ultimate-school-games.firebaseapp.com",
    projectId: "ultimate-school-games",
    storageBucket: "ultimate-school-games.firebasestorage.app",
    messagingSenderId: "870332221562",
    appId: "1:870332221562:web:da450674b44bbfa18513c3",
    measurementId: "G-F8MFSLNWVB"
  };
  
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
</script>
</head>
<body>

<div class="menu visible" id="menu">
  <h1>Ultimate School Games</h1>
  <button onclick="startClicker()">ğŸ« Clicker</button>
  <button onclick="startRunner()">ğŸƒ Runner</button>
  <button onclick="openSettings()">âš™ Settings</button>
</div>

<!-- --- Clicker Game --- -->
<div class="game" id="clickerGame">
  <h2>School Clicker</h2>
  <p>Clicks: <span id="clickCount">0</span></p>
  <button onclick="clickerClick()">Klick mich!</button>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- --- Runner Game --- -->
<div class="game" id="runnerGame">
  <h2>School Runner</h2>
  <p>Level: <span id="runnerLevel">1</span> | XP: <span id="runnerXP">0</span></p>
  <div id="gameArea">
    <img src="assets/images/player.png" id="player" style="width:50px; position:relative; top:0px;">
  </div>
  <button onclick="jump()">Sprung</button>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<!-- --- Settings --- -->
<div class="settings" id="settingsMenu">
  <h2>âš™ Einstellungen</h2>
  <div>
    <h4>ğŸµ Musik</h4>
    <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5" onchange="setVolume(this.value)">
  </div>
  <div>
    <h4>ğŸ­ Skin auswÃ¤hlen</h4>
    <button onclick="changeSkin('schueler')">SchÃ¼ler</button>
    <button onclick="changeSkin('lehrer')">Lehrer</button>
  </div>
  <div>
    <h4>ğŸ–¼ Hintergrundbild</h4>
    <button onclick="changeBG('school')">Schule</button>
    <button onclick="changeBG('meme')">Meme</button>
    <button onclick="changeBG('gaming')">Gaming</button>
  </div>
  <div>
    <h4>ğŸ” Konto</h4>
    <input id="emailInput" type="email" placeholder="Email">
    <input id="passwordInput" type="password" placeholder="Passwort">
    <button onclick="registerUser()">Registrieren</button>
    <button onclick="loginUser()">Login</button>
    <button onclick="logoutUser()">Logout</button>
  </div>
  <div>
    <h4>ğŸ’¾ Spielstand</h4>
    <button onclick="exportSave()">Export</button>
    <button onclick="importSave()">Import</button>
  </div>
  <button onclick="backToMenu()">ğŸ”™ Menu</button>
</div>

<script>
/* -------------------------
        GLOBAL STATE
------------------------- */
let state = {
  count: 0,
  multiplier: 1,
  level: 1,
  xp: 0,
  skin: 'schueler',
  bgPack: 'school',
  prestige: 0,
  loggedInUser: null
};

/* -------------------------
       MENU FUNCTIONS
------------------------- */
function startClicker(){ showGame('clickerGame'); }
function startRunner(){ showGame('runnerGame'); }
function openSettings(){ showGame('settingsMenu'); }
function backToMenu(){ document.querySelectorAll('.game, .settings').forEach(g=>g.classList.remove('visible')); document.getElementById('menu').classList.add('visible'); }
function showGame(id){ document.querySelectorAll('.game, .settings').forEach(g=>g.classList.remove('visible')); document.getElementById(id).classList.add('visible'); }

/* -------------------------
       CLICKER FUNCTIONS
------------------------- */
function clickerClick(){ state.count += state.multiplier; document.getElementById('clickCount').textContent = state.count; saveGameToCloud(); }

/* -------------------------
       RUNNER FUNCTIONS
------------------------- */
let isJumping = false;
function jump(){
  if(isJumping) return;
  isJumping=true;
  const player = document.getElementById('player');
  let pos = 0;
  let up = setInterval(()=>{ if(pos>=100){ clearInterval(up); down(); } else { pos+=10; player.style.top = -pos+'px'; }},50);
  function down(){ let down = setInterval(()=>{ if(pos<=0){ clearInterval(down); player.style.top='0px'; isJumping=false; } else { pos-=10; player.style.top=-pos+'px'; }},50); }
}

/* -------------------------
       SETTINGS FUNCTIONS
------------------------- */
function setVolume(v){ console.log('Volume:',v); }
function changeSkin(s){ state.skin = s; alert('Skin geÃ¤ndert!'); saveGameToCloud(); }
function changeBG(bg){ state.bgPack = bg; alert('Hintergrund geÃ¤ndert!'); saveGameToCloud(); }

/* -------------------------
     EXPORT / IMPORT SAVE
------------------------- */
function exportSave(){
  const blob = new Blob([JSON.stringify(state)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='save.json'; a.click();
}
function importSave(){
  const input = document.createElement('input'); input.type='file'; input.accept='.json';
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = e => { Object.assign(state, JSON.parse(e.target.result)); updateDisplay(); alert('Spielstand geladen!'); }
    reader.readAsText(file);
  };
  input.click();
}

/* -------------------------
       UPDATE DISPLAY
------------------------- */
function updateDisplay(){
  document.getElementById('clickCount').textContent = state.count;
  document.getElementById('runnerLevel').textContent = state.level;
  document.getElementById('runnerXP').textContent = state.xp;
}

/* -------------------------
       FIREBASE FUNCTIONS
------------------------- */
// Registrierung
function registerUser(){
  const email = document.getElementById('emailInput').value;
  const password = document.getElementById('passwordInput').value;
  auth.createUserWithEmailAndPassword(email,password)
    .then(uc=>{ alert('âœ… Registriert!'); state.loggedInUser=uc.user.uid; saveGameToCloud(); })
    .catch(e=>alert('âŒ '+e.message));
}
// Login
function loginUser(){
  const email = document.getElementById('emailInput').value;
  const password = document.getElementById('passwordInput').value;
  auth.signInWithEmailAndPassword(email,password)
    .then(uc=>{ alert('âœ… Eingeloggt!'); state.loggedInUser=uc.user.uid; loadGameFromCloud(); })
    .catch(e=>alert('âŒ '+e.message));
}
// Logout
function logoutUser(){ auth.signOut().then(()=>{ state.loggedInUser=null; alert('ğŸ”“ Ausgeloggt'); }); }

// Cloud Save
function saveGameToCloud(){
  if(!state.loggedInUser) return;
  db.collection('users').doc(state.loggedInUser).set(state)
    .then(()=>console.log('âœ” Cloud Save'))
    .catch(e=>console.error(e));
}
// Cloud Load
function loadGameFromCloud(){
  if(!state.loggedInUser) return;
  db.collection('users').doc(state.loggedInUser).get()
    .then(doc=>{
      if(doc.exists){ Object.assign(state, doc.data()); updateDisplay(); alert('âœ… Cloud Spielstand geladen'); }
      else alert('â„¹ Kein Cloud-Spielstand gefunden');
    }).catch(e=>console.error(e));
}

// Automatisches speichern alle 30s
setInterval(()=>{ if(state.loggedInUser) saveGameToCloud(); }, 30000);
</script>

</body>
</html>
